<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="google" content="translate">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="Yff2j8JlvuxGq1xMU5RiItiDzE7joDwedatYpX5hfd8">
  <meta name="robots" content="index, follow">
  <meta name="keywords"
    content="autossuficiência, orçamento doméstico, dinheiro, planejamento orçamentário, finanças pessoais" />
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link rel="stylesheet" href="style-index.css">
  <title>Autossuficiência</title>
</head>

<body>
  <div class="navigation">
    <nav>
      <div class="nav-wrapper">
        <span class="brand-logo center">Autossuficiência</span>
      </div>
    </nav>
  </div>
  <div class="user-container">
    <div id="user-name" class="user-name"></div> <!-- Adicionando a exibição do nome do usuário -->
    <button onclick="logout()" class="btn red btn-logout">Logout</button>
    <button onclick="deleteAccount()" class="btn red btn-logout">Excluir Conta</button>
    <label for="yearSelector" style="display: flex; margin-top: 20px;justify-content: center;">Selecione o ano:</label>
    <div class="input-field" style="display: flex; justify-content: center;">
      <select id="yearSelector" style="width: 100px;height: 40px;border: 1px solid #bdbdbd;background: #ffffff;background-blend-mode: normal;">
        <!-- As opções de ano serão adicionadas aqui pelo JavaScript -->
      </select>
    </div>
  </div>
  <div class="main-content">
    <div class="container">
      <div class="row">
        <div class="col s12">
          <div class="card-columns">
            <!-- Cards de navegação -->
            <div class="card" id="card1">
              <div class="card-content"><span class="card-title">Janeiro</span></div>
            </div>
            <div class="card" id="card2">
              <div class="card-content"><span class="card-title">Fevereiro</span></div>
            </div>
            <div class="card" id="card3">
              <div class="card-content"><span class="card-title">Março</span></div>
            </div>
            <div class="card" id="card4">
              <div class="card-content"><span class="card-title">Abril</span></div>
            </div>
            <div class="card" id="card5">
              <div class="card-content"><span class="card-title">Maio</span></div>
            </div>
            <div class="card" id="card6">
              <div class="card-content"><span class="card-title">Junho</span></div>
            </div>
            <div class="card" id="card7">
              <div class="card-content"><span class="card-title">Julho</span></div>
            </div>
            <div class="card" id="card8">
              <div class="card-content"><span class="card-title">Agosto</span></div>
            </div>
            <div class="card" id="card9">
              <div class="card-content"><span class="card-title">Setembro</span></div>
            </div>
            <div class="card" id="card10">
              <div class="card-content"><span class="card-title">Outubro</span></div>
            </div>
            <div class="card" id="card11">
              <div class="card-content"><span class="card-title">Novembro</span></div>
            </div>
            <div class="card" id="card12">
              <div class="card-content"><span class="card-title">Dezembro</span></div>
            </div>
            <div class="card" id="card13">
              <div class="card-content"><span class="card-title">Cartão de crédito</span></div>
            </div>
            <div class="card" id="card14">
              <div class="card-content"><span class="card-title">Perguntas Frequêntes</span></div>
            </div>
            <div class="card" id="card15">
              <div class="card-content"><span class="card-title">Privacidade</span></div>
            </div>
            <div class="card" id="card16">
              <div class="card-content"><span class="card-title">Ferramentas</span></div>
            </div>
            <div class="card" id="card17">
              <div class="card-content"><span class="card-title">Dízimos</span></div>
            </div>
            <div class="card" id="card18">
              <div class="card-content"><span class="card-title">Relatório</span></div>
            </div>
            <div class="card" id="card19">
              <div class="card-content"><span class="card-title">Gráficos</span></div>
            </div>
            <div class="card" id="card20">
              <div class="card-content"><span class="card-title">Assistente</span></div>
            </div>
            <div class="card" id="limparDadosCard">
              <div class="card-content"><span class="card-title">Recomeçar</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <footer class="page-footer">
    <div class="container">
      <div class="row">
        <div class="row">
          <div class="col s12">
            <p class="custom-flow-text">
              "Organizai-vos; preparai todas as coisas necessárias e estabelecei uma casa, sim, uma casa de
              oração, uma casa de jejum, uma casa de fé, uma casa de aprendizado, uma casa de glória, uma casa de ordem,
              uma
              casa de Deus." D&C 88:119
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="divider"></div>
    <div class="container">
      <div class="row">
        <div class="col s12 center-align">
          <p class="grey-text text-lighten-4">Ferramenta livre de cálculo de capital de giro © 2024 Autossuficiência.
            Todos os direitos reservados.</p>
        </div>
      </div>
    </div>
  </footer>
  <script type="module">
    // Importa os módulos necessários do Firebase
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js';
    import { getDatabase, ref, remove } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js';
    import firebaseConfig from './config.js';

    // Inicializa o Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    // Variável para o ano atual
    let currentYear;

    // Verificação do estado de autenticação e exibição do nome do usuário
    onAuthStateChanged(auth, (user) => {
      if (user) {
        const displayName = user.displayName || user.email;
        document.getElementById('user-name').textContent = `Bem-vindo, ${displayName}!`;
        setupYearSelector(); // Adiciona os anos no select
      } else {
        window.location.href = "login.html"; // Redireciona para a página de login se não estiver autenticado
      }
    });

    // Gera as opções de ano e seleciona o ano salvo no localStorage
    function setupYearSelector() {
      const yearSelector = document.getElementById("yearSelector");
      const startYear = 2020;
      const endYear = 2030;
      let savedYear = localStorage.getItem('selectedYear');

      // Gera as opções de ano
      for (let year = startYear; year <= endYear; year++) {
        const option = document.createElement("option");
        option.value = year;
        option.text = year;
        yearSelector.add(option);
      }

      // Seleciona o ano salvo no localStorage, se existir, senão pega o ano atual
      currentYear = savedYear ? parseInt(savedYear) : new Date().getFullYear();
      yearSelector.value = currentYear;

      // Salva o ano selecionado no localStorage quando ele for alterado pelo usuário
      yearSelector.addEventListener('change', function () {
        currentYear = parseInt(this.value); // Atualiza a variável global
        localStorage.setItem('selectedYear', this.value);
      });

    }

    // Função de logout
    window.logout = function () {
      signOut(auth).then(() => {
        window.location.href = "login.html"; // Redireciona para a página de login após logout
      }).catch((error) => {
        console.error("Erro ao fazer logout: ", error);
      });
    };

    // Função de excluir conta
    window.deleteAccount = function () {
      window.location.href = "delete_account.html"; // Redireciona para a página de exclusão de conta
    };



    // Função para limpar os dados do Firebase Realtime Database e localStorage
    function limparDados() {
      // Confirmação do usuário antes de limpar os dados
      if (confirm("Tem certeza que deseja limpar todos os seus dados? Esta ação é irreversível.")) {
        // Limpar localStorage
        localStorage.clear();

        // Obter o userId do localStorage ou da autenticação
        const userId = localStorage.getItem('userId') || (auth.currentUser ? auth.currentUser.uid : null);

        // Verificar se o userId está disponível
        if (userId) {
          // Referência para os dados do cartão de crédito
          const creditCardDataRef = ref(database, 'creditCardData/' + userId);

          // Referência para os dados de cada mês
          const januaryRef = ref(database, 'users/' + userId + '/january');
          const februaryRef = ref(database, 'users/' + userId + '/february');
          const marchRef = ref(database, 'users/' + userId + '/march');
          const aprilRef = ref(database, 'users/' + userId + '/april');
          const mayRef = ref(database, 'users/' + userId + '/may');
          const juneRef = ref(database, 'users/' + userId + '/june');
          const julyRef = ref(database, 'users/' + userId + '/july');
          const augustRef = ref(database, 'users/' + userId + '/august');
          const septemberRef = ref(database, 'users/' + userId + '/september');
          const octoberRef = ref(database, 'users/' + userId + '/october');
          const novemberRef = ref(database, 'users/' + userId + '/november');
          const decemberRef = ref(database, 'users/' + userId + '/december');

          // Referência para o nó raiz de creditCardBalances
          const creditCardBalancesRef = ref(database, 'creditCardBalances/' + userId);

          // Referência para os dados do usuário
          const userRef = ref(database, 'users/' + userId);

          // Remover os dados do Firebase Realtime Database
          Promise.all([
            remove(creditCardDataRef),
            remove(januaryRef),
            remove(februaryRef),
            remove(marchRef),
            remove(aprilRef),
            remove(mayRef),
            remove(juneRef),
            remove(julyRef),
            remove(augustRef),
            remove(septemberRef),
            remove(octoberRef),
            remove(novemberRef),
            remove(decemberRef),
            remove(creditCardBalancesRef), // Remove todos os dados dentro de creditCardBalances
            remove(userRef)
          ])
            .then(() => {
              console.log("Todos os dados do usuário apagados do Firebase.");
              alert("Os dados foram apagados do Firebase e localStorage."); // Mensagem de confirmação
            })
            .catch((error) => {
              console.error("Erro ao apagar dados do Firebase: ", error);
            });
        } else {
          alert("Usuário não autenticado. Não é possível limpar dados do Firebase.");
        }
      }
    }

    // Adiciona eventos de clique aos cards após o DOM ser carregado
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("limparDadosCard").addEventListener("click", limparDados);

      document.getElementById("card1").addEventListener("click", () => window.location.href = `1Jan.html?year=${currentYear}`);
      document.getElementById("card2").addEventListener("click", () => window.location.href = `2Fev.html?year=${currentYear}`);
      document.getElementById("card3").addEventListener("click", () => window.location.href = `3Mar.html?year=${currentYear}`);
      document.getElementById("card4").addEventListener("click", () => window.location.href = `4Abr.html?year=${currentYear}`);
      document.getElementById("card5").addEventListener("click", () => window.location.href = `5Mai.html?year=${currentYear}`);
      document.getElementById("card6").addEventListener("click", () => window.location.href = `6Jun.html?year=${currentYear}`);
      document.getElementById("card7").addEventListener("click", () => window.location.href = `7Jul.html?year=${currentYear}`);
      document.getElementById("card8").addEventListener("click", () => window.location.href = `8Ago.html?year=${currentYear}`);
      document.getElementById("card9").addEventListener("click", () => window.location.href = `9Set.html?year=${currentYear}`);
      document.getElementById("card10").addEventListener("click", () => window.location.href = `10Out.html?year=${currentYear}`);
      document.getElementById("card11").addEventListener("click", () => window.location.href = `11Nov.html?year=${currentYear}`);
      document.getElementById("card12").addEventListener("click", () => window.location.href = `12Dez.html?year=${currentYear}`);
      document.getElementById("card13").addEventListener("click", () => window.location.href = `cartao_de_credito.html?year=${currentYear}`);
      document.getElementById("card14").addEventListener("click", () => window.location.href = "perguntas_frequentes.html");
      document.getElementById("card15").addEventListener("click", () => window.location.href = "privacy.html");
      document.getElementById("card16").addEventListener("click", () => window.location.href = "ferramentas.html");
      document.getElementById("card17").addEventListener("click", () => window.location.href = `dizimo.html?year=${currentYear}`);
      document.getElementById("card18").addEventListener("click", () => window.location.href = `relatorio.html?year=${currentYear}`);
      document.getElementById("card19").addEventListener("click", () => window.location.href = `chart.html?year=${currentYear}`);
      document.getElementById("card20").addEventListener("click", () => window.location.href = `aichat.html?year=${currentYear}`);
    });

    yearSelector.addEventListener('change', function () {
      currentYear = parseInt(this.value); // Atualiza a variável global
      localStorage.setItem('selectedYear', this.value); // Salva o ano atual no localStorage
    });
  </script>
</body>

</html>